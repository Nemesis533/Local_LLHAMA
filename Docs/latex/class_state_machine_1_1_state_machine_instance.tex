\doxysection{State\+Machine.\+State\+Machine\+Instance Class Reference}
\hypertarget{class_state_machine_1_1_state_machine_instance}{}\label{class_state_machine_1_1_state_machine_instance}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_state_machine_1_1_state_machine_instance_ac37f810c872b23f4d89f88c0211fe3f7}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, \mbox{\hyperlink{class_l_l_m_1_1_l_l_m___class}{LLM\+\_\+\+Class}} command\+\_\+llm, device, ha\+\_\+client, stdout\+\_\+buffer=None)
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a55794d7615d0b801c68f1a6871b9c6ea}\label{class_state_machine_1_1_state_machine_instance_a55794d7615d0b801c68f1a6871b9c6ea} 
{\bfseries print\+\_\+once} (self, message, end=\textquotesingle{}\textbackslash{}n\textquotesingle{})
\item 
\mbox{\hyperlink{class_state_machine_1_1_state_machine_instance_af8cf5735df790033bf6be988e01f05eb}{command\+\_\+worker}} (self)
\item 
\mbox{\hyperlink{class_state_machine_1_1_state_machine_instance_ad14e2c3482a9e62c685139d13245e100}{sound\+\_\+player\+\_\+worker}} (self)
\item 
\mbox{\hyperlink{class_state_machine_1_1_state_machine_instance_a5551b0564e963f20a2af85efece8fe0d}{play\+\_\+sound}} (self, sound\+\_\+action)
\item 
\mbox{\hyperlink{class_state_machine_1_1_state_machine_instance_a8f075e216391d242a6bce950f53f73c4}{transition}} (self, \mbox{\hyperlink{class_state_machine_1_1_state}{State}} new\+\_\+state)
\item 
\mbox{\hyperlink{class_state_machine_1_1_state_machine_instance_a27380df8c6e8b29347b48104737080dd}{start\+\_\+recording}} (self)
\item 
\mbox{\hyperlink{class_state_machine_1_1_state_machine_instance_a4259bf61922a6acef7ca119935e41b9f}{speak}} (self)
\item 
\mbox{\hyperlink{class_state_machine_1_1_state_machine_instance_a468289d60815645422df8778e9881a92}{handle\+\_\+error}} (self)
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a12b4868e8dc2a5746844a3d550ed39c9}\label{class_state_machine_1_1_state_machine_instance_a12b4868e8dc2a5746844a3d550ed39c9} 
{\bfseries run} (self)
\end{DoxyCompactItemize}
\doxysubsubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a4d541b548e3844977867b1a915fa6c16}\label{class_state_machine_1_1_state_machine_instance_a4d541b548e3844977867b1a915fa6c16} 
{\bfseries device} = device
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_acfb8113aaa4024294427eb97199d9747}\label{class_state_machine_1_1_state_machine_instance_acfb8113aaa4024294427eb97199d9747} 
int {\bfseries noise\+\_\+floor} = 0
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a548d845bb48641f85577243220c966cb}\label{class_state_machine_1_1_state_machine_instance_a548d845bb48641f85577243220c966cb} 
\mbox{\hyperlink{class_state_machine_1_1_state}{State}} {\bfseries state} = State.\+LOADING
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a2ab927de8e276bfa227980bcdcea1c93}\label{class_state_machine_1_1_state_machine_instance_a2ab927de8e276bfa227980bcdcea1c93} 
{\bfseries lock} = threading.\+Lock()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_abd107701ad9892306156bfd174a4fd2c}\label{class_state_machine_1_1_state_machine_instance_abd107701ad9892306156bfd174a4fd2c} 
Queue {\bfseries result\+\_\+queue} = Queue()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a3d3b7c12477f373bfc53e5179598bc5f}\label{class_state_machine_1_1_state_machine_instance_a3d3b7c12477f373bfc53e5179598bc5f} 
Queue {\bfseries transcription\+\_\+queue} = Queue()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a65beeb698cba249a3aebae8451dfdfaa}\label{class_state_machine_1_1_state_machine_instance_a65beeb698cba249a3aebae8451dfdfaa} 
Queue {\bfseries command\+\_\+queue} = Queue()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_aae69294d1859aa850c08336a10f427f3}\label{class_state_machine_1_1_state_machine_instance_aae69294d1859aa850c08336a10f427f3} 
Queue {\bfseries sound\+\_\+action\+\_\+queue} = Queue()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a79e4ffcbeaa88adfa22a1e51c914e7e5}\label{class_state_machine_1_1_state_machine_instance_a79e4ffcbeaa88adfa22a1e51c914e7e5} 
Queue {\bfseries speech\+\_\+queue} = Queue()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_ad9cb95996cc7810029effffe578f974c}\label{class_state_machine_1_1_state_machine_instance_ad9cb95996cc7810029effffe578f974c} 
{\bfseries noise\+\_\+floor\+\_\+monitor} = \mbox{\hyperlink{class_sound___and___speech_1_1_noise_floor_monitor}{Noise\+Floor\+Monitor}}()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_aeb60833ccbcb9c847d05de8e07415096}\label{class_state_machine_1_1_state_machine_instance_aeb60833ccbcb9c847d05de8e07415096} 
{\bfseries awaker} = \mbox{\hyperlink{class_sound___and___speech_1_1_wake_word_listener}{Wake\+Word\+Listener}}(self.\+noise\+\_\+floor\+\_\+monitor)
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a3677573729fa0a323f3b2e0575824f64}\label{class_state_machine_1_1_state_machine_instance_a3677573729fa0a323f3b2e0575824f64} 
{\bfseries recorder} = \mbox{\hyperlink{class_sound___and___speech_1_1_audio_recorder_class}{Audio\+Recorder\+Class}}(noise\+\_\+floor\+\_\+monitor=self.\+noise\+\_\+floor\+\_\+monitor)
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a2d121fe229707ff5417827f6786b5e8f}\label{class_state_machine_1_1_state_machine_instance_a2d121fe229707ff5417827f6786b5e8f} 
{\bfseries transcriptor} = \mbox{\hyperlink{class_sound___and___speech_1_1_audio_transcription_class}{Audio\+Transcription\+Class}}()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a07f906dcabdc922d1739a40cbcb32ab5}\label{class_state_machine_1_1_state_machine_instance_a07f906dcabdc922d1739a40cbcb32ab5} 
{\bfseries sound\+\_\+player} = \mbox{\hyperlink{class_sound___and___speech_1_1_sound_player}{Sound\+Player}}()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_ac8e26bf73026f66369f7bb88f0e6d3b5}\label{class_state_machine_1_1_state_machine_instance_ac8e26bf73026f66369f7bb88f0e6d3b5} 
{\bfseries speaker} = \mbox{\hyperlink{class_sound___and___speech_1_1_text_to_speech}{Text\+To\+Speech}}()
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_ab2fa8bc2b2db07feeb75f805247315ba}\label{class_state_machine_1_1_state_machine_instance_ab2fa8bc2b2db07feeb75f805247315ba} 
{\bfseries command\+\_\+llm} = command\+\_\+llm
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a42aadd6f8ade3e2d52a1b61b70a83c08}\label{class_state_machine_1_1_state_machine_instance_a42aadd6f8ade3e2d52a1b61b70a83c08} 
{\bfseries vitality} = \mbox{\hyperlink{class_state_machine_1_1_local_l_l_m_checker}{Local\+LLMChecker}}(stdout\+\_\+buffer=stdout\+\_\+buffer)
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a90f9201ebe89dfcb1fa91c5bf0ed598c}\label{class_state_machine_1_1_state_machine_instance_a90f9201ebe89dfcb1fa91c5bf0ed598c} 
\mbox{\hyperlink{class_h_a___interfacer_1_1_home_assistant_client}{Home\+Assistant\+Client}} {\bfseries ha\+\_\+client} = ha\+\_\+client
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_ac62450f05616182b52935f40e11e2544}\label{class_state_machine_1_1_state_machine_instance_ac62450f05616182b52935f40e11e2544} 
{\bfseries wakeword\+\_\+thread} = threading.\+Thread(target=self.\+awaker.\+listen\+\_\+for\+\_\+wake\+\_\+word, args=(self.\+result\+\_\+queue,))
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a8a6c2974b509c6f20974749bceafb287}\label{class_state_machine_1_1_state_machine_instance_a8a6c2974b509c6f20974749bceafb287} 
{\bfseries sound\+\_\+thread} = threading.\+Thread(target=self.\+sound\+\_\+player\+\_\+worker)
\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{class_state_machine_1_1_state_machine_instance_a9d14ae63794be822d6eef386dc8ffc6b}\label{class_state_machine_1_1_state_machine_instance_a9d14ae63794be822d6eef386dc8ffc6b} 
{\bfseries \+\_\+last\+\_\+printed\+\_\+message} = None
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}@brief Core state machine managing voice assistant states, audio input/output, command processing, and interactions.
\end{DoxyVerb}
 

\label{doc-constructors}
\Hypertarget{class_state_machine_1_1_state_machine_instance_doc-constructors}
\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{class_state_machine_1_1_state_machine_instance_ac37f810c872b23f4d89f88c0211fe3f7}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}!\_\_init\_\_@{\_\_init\_\_}}
\index{\_\_init\_\_@{\_\_init\_\_}!StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection{\texorpdfstring{\_\_init\_\_()}{\_\_init\_\_()}}
{\footnotesize\ttfamily \label{class_state_machine_1_1_state_machine_instance_ac37f810c872b23f4d89f88c0211fe3f7} 
State\+Machine.\+State\+Machine\+Instance.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{\mbox{\hyperlink{class_l_l_m_1_1_l_l_m___class}{LLM\+\_\+\+Class}}}]{command\+\_\+llm}{, }\item[{}]{device}{, }\item[{}]{ha\+\_\+client}{, }\item[{}]{stdout\+\_\+buffer}{ = {\ttfamily None}}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Initialize the state machine, threads, queues, and component instances.
@param command_llm The LLM instance used for command parsing.
@param device The computation device (e.g., "cuda" or "cpu").
@param ha_client The Home Assistant client interface.
\end{DoxyVerb}
 

\label{doc-func-members}
\Hypertarget{class_state_machine_1_1_state_machine_instance_doc-func-members}
\doxysubsection{Member Function Documentation}
\Hypertarget{class_state_machine_1_1_state_machine_instance_af8cf5735df790033bf6be988e01f05eb}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}!command\_worker@{command\_worker}}
\index{command\_worker@{command\_worker}!StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection{\texorpdfstring{command\_worker()}{command\_worker()}}
{\footnotesize\ttfamily \label{class_state_machine_1_1_state_machine_instance_af8cf5735df790033bf6be988e01f05eb} 
State\+Machine.\+State\+Machine\+Instance.\+command\+\_\+worker (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Thread worker that processes transcriptions and parses commands using the LLM.
\end{DoxyVerb}
 \Hypertarget{class_state_machine_1_1_state_machine_instance_a468289d60815645422df8778e9881a92}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}!handle\_error@{handle\_error}}
\index{handle\_error@{handle\_error}!StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection{\texorpdfstring{handle\_error()}{handle\_error()}}
{\footnotesize\ttfamily \label{class_state_machine_1_1_state_machine_instance_a468289d60815645422df8778e9881a92} 
State\+Machine.\+State\+Machine\+Instance.\+handle\+\_\+error (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Handle errors by transitioning to ERROR state, playing error sound, and returning to LISTENING.
\end{DoxyVerb}
 \Hypertarget{class_state_machine_1_1_state_machine_instance_a5551b0564e963f20a2af85efece8fe0d}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}!play\_sound@{play\_sound}}
\index{play\_sound@{play\_sound}!StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection{\texorpdfstring{play\_sound()}{play\_sound()}}
{\footnotesize\ttfamily \label{class_state_machine_1_1_state_machine_instance_a5551b0564e963f20a2af85efece8fe0d} 
State\+Machine.\+State\+Machine\+Instance.\+play\+\_\+sound (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{sound\+\_\+action}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Enqueue a sound action to be played asynchronously by the sound thread.
@param sound_action The SoundActions enum member to play.
\end{DoxyVerb}
 \Hypertarget{class_state_machine_1_1_state_machine_instance_ad14e2c3482a9e62c685139d13245e100}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}!sound\_player\_worker@{sound\_player\_worker}}
\index{sound\_player\_worker@{sound\_player\_worker}!StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection{\texorpdfstring{sound\_player\_worker()}{sound\_player\_worker()}}
{\footnotesize\ttfamily \label{class_state_machine_1_1_state_machine_instance_ad14e2c3482a9e62c685139d13245e100} 
State\+Machine.\+State\+Machine\+Instance.\+sound\+\_\+player\+\_\+worker (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Background thread that plays queued sound actions asynchronously.
\end{DoxyVerb}
 \Hypertarget{class_state_machine_1_1_state_machine_instance_a4259bf61922a6acef7ca119935e41b9f}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}!speak@{speak}}
\index{speak@{speak}!StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection{\texorpdfstring{speak()}{speak()}}
{\footnotesize\ttfamily \label{class_state_machine_1_1_state_machine_instance_a4259bf61922a6acef7ca119935e41b9f} 
State\+Machine.\+State\+Machine\+Instance.\+speak (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Speak the next queued speech response and play closing sound.
\end{DoxyVerb}
 \Hypertarget{class_state_machine_1_1_state_machine_instance_a27380df8c6e8b29347b48104737080dd}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}!start\_recording@{start\_recording}}
\index{start\_recording@{start\_recording}!StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection{\texorpdfstring{start\_recording()}{start\_recording()}}
{\footnotesize\ttfamily \label{class_state_machine_1_1_state_machine_instance_a27380df8c6e8b29347b48104737080dd} 
State\+Machine.\+State\+Machine\+Instance.\+start\+\_\+recording (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Start audio recording and enqueue transcription if valid.
\end{DoxyVerb}
 \Hypertarget{class_state_machine_1_1_state_machine_instance_a8f075e216391d242a6bce950f53f73c4}\index{StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}!transition@{transition}}
\index{transition@{transition}!StateMachine.StateMachineInstance@{StateMachine.StateMachineInstance}}
\doxysubsubsection{\texorpdfstring{transition()}{transition()}}
{\footnotesize\ttfamily \label{class_state_machine_1_1_state_machine_instance_a8f075e216391d242a6bce950f53f73c4} 
State\+Machine.\+State\+Machine\+Instance.\+transition (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{\mbox{\hyperlink{class_state_machine_1_1_state}{State}}}]{new\+\_\+state}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}@brief Safely transition the state machine to a new state.
@param new_state The new State to transition to.
\end{DoxyVerb}
 

The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
State\+Machine.\+py\end{DoxyCompactItemize}
